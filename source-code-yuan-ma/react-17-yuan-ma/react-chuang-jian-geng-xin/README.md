# React 架构

在最近的几个版本中，React 架构主要体验为`V15`和`V16+` 

### 老版React

V15版本也就是所说的老版React，主要的分为两个板块：

* Reconcile 协调器 负责找出组件的差异
* Renderer 渲染器 将差异更新到DOM上

它的更新是通过递归的更新组件找出差异，而递归一旦开始是不会中断的，如果DOM树的层级很深，那么时间复杂度会很高，**一帧**中所耗时肯定不止`16ms`，因此，这种**同步更新**的方式在**屏幕刷新**非常不友好。

所以官方重构了React，实现了一种**可中断的异步更新**，体现在了`V16+`版本中。

### 新版React

V16+ 版本中采用Fiber架构，实现了可中断的异步更新，新版架构的板块有：

* Scheduler 调度器  根据优先级高的任务，优先进入协调器
* Reconcile 协调器 负责找出组件的差异
* Renderer 渲染器  将差异更新到DOM中

V16+ 版本新增了`Scheduler` 调度器，目的是为了解决**屏幕刷新**的问题，同时解决了任务的优先级问题（亟需体现在页面的任务优先级高）。

#### Scheduler 调度器

上面提到调度器是为了解决**屏幕刷新**的问题，具体体现在当一帧中还有剩余时间时，将**控制权**（执行JS）给到**调度器**，这样调度器在剩余的时间里优先执行高优先级的任务。

这样一来，在连续的帧中，分批次的执行了很多的任务，将任务打散在了每一帧中，这样一帧的执行时间基本保持在`16ms`，这些任务也都执行了，这就是**时间切片**。

目前，部分浏览器已经实现了这一功能 `requestIdleCallback` API，但是由于兼容性不太好，

